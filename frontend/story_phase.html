<!-- Story Phase UI -->
<div id="story-phase-content" class="hidden space-y-6">
    <!-- Story Generation Header -->
    <div class="bg-white rounded-xl shadow-lg p-6">
        <div class="flex items-center justify-between mb-6">
            <div>
                <h2 class="text-2xl font-bold text-gray-800">Fin√°ln√≠ p≈ô√≠bƒõh</h2>
                <p class="text-gray-600">Vygenerujte a upravte sv≈Øj dokonƒçen√Ω p≈ô√≠bƒõh</p>
            </div>
            <div class="flex space-x-3">
                <button onclick="generateFinalStory()" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 flex items-center gap-2">
                    <span>‚ú®</span> Generovat p≈ô√≠bƒõh
                </button>
                <button onclick="exportStory()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 flex items-center gap-2">
                    <span>üìÑ</span> Export
                </button>
                <button onclick="shareStory()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 flex items-center gap-2">
                    <span>üîó</span> Sd√≠let
                </button>
            </div>
        </div>
        
        <!-- Story Stats -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 text-center">
            <div class="bg-purple-50 p-4 rounded-lg">
                <div class="text-2xl font-bold text-purple-600" id="story-word-count">0</div>
                <div class="text-sm text-purple-800">Slov</div>
            </div>
            <div class="bg-blue-50 p-4 rounded-lg">
                <div class="text-2xl font-bold text-blue-600" id="story-pages">0</div>
                <div class="text-sm text-blue-800">Stran</div>
            </div>
            <div class="bg-green-50 p-4 rounded-lg">
                <div class="text-2xl font-bold text-green-600" id="reading-time">0</div>
                <div class="text-sm text-green-800">Min ƒçten√≠</div>
            </div>
            <div class="bg-yellow-50 p-4 rounded-lg">
                <div class="text-2xl font-bold text-yellow-600" id="marketability-score">0</div>
                <div class="text-sm text-yellow-800">Market. sk√≥re</div>
            </div>
            <div class="bg-red-50 p-4 rounded-lg">
                <div class="text-2xl font-bold text-red-600" id="overall-quality">0</div>
                <div class="text-sm text-red-800">Kvalita</div>
            </div>
        </div>
    </div>

    <!-- Story Content -->
    <div class="bg-white rounded-xl shadow-lg">
        <div class="p-6 border-b border-gray-200">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-xl font-bold text-gray-800" id="final-story-title">V√°≈° p≈ô√≠bƒõh</h3>
                    <p class="text-gray-600" id="story-subtitle">Upravte a dokonƒçete sv≈Øj p≈ô√≠bƒõh</p>
                </div>
                <div class="flex space-x-2">
                    <button onclick="toggleEditMode()" class="px-3 py-1 rounded text-sm bg-gray-100 hover:bg-gray-200" id="edit-mode-btn">
                        ‚úèÔ∏è Editovat
                    </button>
                    <button onclick="togglePreviewMode()" class="px-3 py-1 rounded text-sm bg-gray-100 hover:bg-gray-200" id="preview-mode-btn">
                        üëÅÔ∏è N√°hled
                    </button>
                    <button onclick="toggleFullscreen()" class="px-3 py-1 rounded text-sm bg-gray-100 hover:bg-gray-200">
                        üîç Cel√° obrazovka
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Story Editor -->
        <div id="story-editor" class="p-6">
            <div id="story-loading" class="text-center py-12 hidden">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"></div>
                <p class="text-gray-600">Generuji v√°≈° p≈ô√≠bƒõh...</p>
                <div class="mt-4">
                    <div class="bg-gray-200 rounded-full h-2 max-w-md mx-auto">
                        <div id="generation-progress" class="bg-purple-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <p class="text-sm text-gray-500 mt-2" id="generation-status">P≈ô√≠prava...</p>
                </div>
            </div>
            
            <div id="story-content" class="hidden">
                <!-- Story will be populated here -->
                <div class="prose max-w-none">
                    <div id="story-text" class="min-h-96 p-6 border border-gray-200 rounded-lg">
                        <p class="text-gray-500 text-center">P≈ô√≠bƒõh je≈°tƒõ nebyl vygenerov√°n.</p>
                    </div>
                </div>
            </div>
            
            <div id="story-metadata" class="hidden mt-6 p-4 bg-gray-50 rounded-lg">
                <h4 class="font-semibold text-gray-800 mb-3">Metadata p≈ô√≠bƒõhu</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div>
                        <strong>≈Ω√°nr:</strong> <span id="meta-genre">-</span>
                    </div>
                    <div>
                        <strong>T√©ma:</strong> <span id="meta-theme">-</span>
                    </div>
                    <div>
                        <strong>C√≠lov√° skupina:</strong> <span id="meta-audience">-</span>
                    </div>
                    <div>
                        <strong>T√≥n:</strong> <span id="meta-tone">-</span>
                    </div>
                    <div>
                        <strong>Kl√≠ƒçov√© prvky:</strong> <span id="meta-elements">-</span>
                    </div>
                    <div>
                        <strong>Symboly:</strong> <span id="meta-symbols">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Options -->
    <div id="export-panel" class="hidden bg-white rounded-xl shadow-lg p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4">Export mo≈ænosti</h3>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="export-option p-4 border border-gray-200 rounded-lg hover:border-blue-300 cursor-pointer" onclick="exportFormat('pdf')">
                <div class="text-center">
                    <div class="text-3xl mb-2">üìÑ</div>
                    <h4 class="font-semibold">PDF</h4>
                    <p class="text-sm text-gray-600">Profesion√°ln√≠ form√°t pro tisk</p>
                </div>
            </div>
            
            <div class="export-option p-4 border border-gray-200 rounded-lg hover:border-blue-300 cursor-pointer" onclick="exportFormat('docx')">
                <div class="text-center">
                    <div class="text-3xl mb-2">üìù</div>
                    <h4 class="font-semibold">DOCX</h4>
                    <p class="text-sm text-gray-600">Microsoft Word dokument</p>
                </div>
            </div>
            
            <div class="export-option p-4 border border-gray-200 rounded-lg hover:border-blue-300 cursor-pointer" onclick="exportFormat('epub')">
                <div class="text-center">
                    <div class="text-3xl mb-2">üìö</div>
                    <h4 class="font-semibold">EPUB</h4>
                    <p class="text-sm text-gray-600">E-book form√°t</p>
                </div>
            </div>
        </div>
        
        <div class="mt-6 p-4 bg-blue-50 rounded-lg">
            <h5 class="font-semibold text-blue-800 mb-2">Export nastaven√≠</h5>
            <div class="space-y-3">
                <label class="flex items-center space-x-2">
                    <input type="checkbox" id="include-metadata" checked class="rounded">
                    <span class="text-sm">Zahrnout metadata</span>
                </label>
                <label class="flex items-center space-x-2">
                    <input type="checkbox" id="include-scenes" checked class="rounded">
                    <span class="text-sm">Zahrnout detaily sc√©n</span>
                </label>
                <label class="flex items-center space-x-2">
                    <input type="checkbox" id="include-objects" class="rounded">
                    <span class="text-sm">Zahrnout seznam objekt≈Ø</span>
                </label>
            </div>
        </div>
    </div>
</div>

<!-- Project List Modal -->
<div id="project-list-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl mx-4 max-h-90vh overflow-hidden">
        <div class="p-6 border-b border-gray-200">
            <div class="flex items-center justify-between">
                <h2 class="text-2xl font-bold text-gray-800">Moje projekty</h2>
                <div class="flex items-center space-x-3">
                    <button onclick="createNewProject()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                        ‚ûï Nov√Ω projekt
                    </button>
                    <button onclick="closeProjectList()" class="text-gray-500 hover:text-gray-700">‚úï</button>
                </div>
            </div>
            
            <!-- Search and Filters -->
            <div class="mt-4 flex items-center space-x-4">
                <div class="flex-1">
                    <input type="text" id="project-search" placeholder="Hledat projekty..." 
                           class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <select id="project-filter" class="p-2 border border-gray-300 rounded-lg">
                    <option value="all">V≈°echny projekty</option>
                    <option value="active">Aktivn√≠</option>
                    <option value="idea">F√°ze n√°pad</option>
                    <option value="expand">F√°ze expanze</option>
                    <option value="story">F√°ze p≈ô√≠bƒõh</option>
                </select>
                <select id="project-sort" class="p-2 border border-gray-300 rounded-lg">
                    <option value="updated">Posledn√≠ zmƒõny</option>
                    <option value="created">Datum vytvo≈ôen√≠</option>
                    <option value="title">N√°zev A-Z</option>
                    <option value="genre">≈Ω√°nr</option>
                </select>
            </div>
        </div>
        
        <div class="p-6 overflow-y-auto max-h-96">
            <div id="projects-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Projects will be populated here -->
                <div id="no-projects" class="col-span-full text-center py-12 hidden">
                    <div class="text-4xl mb-4">üìù</div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">≈Ω√°dn√© projekty</h3>
                    <p class="text-gray-600 mb-4">Zaƒçnƒõte svou tv≈Ørƒç√≠ cestu vytvo≈ôen√≠m prvn√≠ho projektu</p>
                    <button onclick="createNewProject()" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600">
                        Vytvo≈ôit prvn√≠ projekt
                    </button>
                </div>
            </div>
            
            <div id="projects-loading" class="text-center py-12 hidden">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
                <p class="text-gray-600">Naƒç√≠t√°m projekty...</p>
            </div>
        </div>
    </div>
</div>

<!-- Settings Modal -->
<div id="settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl mx-4 max-h-90vh overflow-hidden">
        <div class="p-6 border-b border-gray-200">
            <div class="flex items-center justify-between">
                <h2 class="text-2xl font-bold text-gray-800">Nastaven√≠</h2>
                <button onclick="closeSettings()" class="text-gray-500 hover:text-gray-700">‚úï</button>
            </div>
        </div>
        
        <div class="flex">
            <!-- Settings Navigation -->
            <div class="w-48 bg-gray-50 p-4">
                <nav class="space-y-2">
                    <button onclick="showSettingsTab('account')" class="settings-tab w-full text-left p-2 rounded hover:bg-gray-100 active" data-tab="account">
                        üë§ √öƒçet
                    </button>
                    <button onclick="showSettingsTab('billing')" class="settings-tab w-full text-left p-2 rounded hover:bg-gray-100" data-tab="billing">
                        üí≥ Billing
                    </button>
                    <button onclick="showSettingsTab('ai')" class="settings-tab w-full text-left p-2 rounded hover:bg-gray-100" data-tab="ai">
                        ü§ñ AI nastaven√≠
                    </button>
                    <button onclick="showSettingsTab('collaboration')" class="settings-tab w-full text-left p-2 rounded hover:bg-gray-100" data-tab="collaboration">
                        üë• Spolupr√°ce
                    </button>
                    <button onclick="showSettingsTab('export')" class="settings-tab w-full text-left p-2 rounded hover:bg-gray-100" data-tab="export">
                        üì§ Export
                    </button>
                </nav>
            </div>
            
            <!-- Settings Content -->
            <div class="flex-1 p-6 overflow-y-auto max-h-96">
                <!-- Account Settings -->
                <div id="account-settings" class="settings-content">
                    <h3 class="text-lg font-semibold mb-4">Nastaven√≠ √∫ƒçtu</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">U≈æivatelsk√© jm√©no</label>
                            <input type="text" id="username-input" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" id="email-input" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nov√© heslo</label>
                            <input type="password" id="password-input" placeholder="Ponechte pr√°zdn√© pro nezmƒõnƒõno" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                        
                        <button onclick="saveAccountSettings()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                            Ulo≈æit zmƒõny
                        </button>
                    </div>
                </div>
                
                <!-- Billing Settings -->
                <div id="billing-settings" class="settings-content hidden">
                    <h3 class="text-lg font-semibold mb-4">Billing & P≈ôedplatn√©</h3>
                    
                    <div id="current-plan" class="mb-6 p-4 bg-blue-50 rounded-lg">
                        <!-- Current plan info will be populated -->
                    </div>
                    
                    <div id="usage-analytics" class="mb-6">
                        <h4 class="font-semibold mb-3">Vyu≈æit√≠ token≈Ø</h4>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <!-- Usage chart will be here -->
                            <div id="token-usage-chart" class="h-32 bg-white rounded border">
                                <p class="text-center text-gray-500 leading-32">Graf vyu≈æit√≠ token≈Ø</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-x-3">
                        <button onclick="upgradePlan()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">
                            Upgrade pl√°n
                        </button>
                        <button onclick="buyTokens()" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600">
                            Koupit tokeny
                        </button>
                        <button onclick="viewBillingHistory()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">
                            Historie plateb
                        </button>
                    </div>
                </div>
                
                <!-- AI Settings -->
                <div id="ai-settings" class="settings-content hidden">
                    <h3 class="text-lg font-semibold mb-4">AI nastaven√≠</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Preferovan√Ω AI model</label>
                            <select id="ai-model-select" class="w-full p-3 border border-gray-300 rounded-lg">
                                <option value="claude-3-5-sonnet">Claude 3.5 Sonnet (Doporuƒçeno)</option>
                                <option value="claude-3-opus">Claude 3 Opus (Nejlep≈°√≠ kvalita)</option>
                                <option value="claude-3-haiku">Claude 3 Haiku (Rychl√Ω)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Kreativita AI</label>
                            <input type="range" id="creativity-slider" min="0" max="1" step="0.1" value="0.7" class="w-full">
                            <div class="flex justify-between text-sm text-gray-500">
                                <span>Konzervativn√≠</span>
                                <span>Vyv√°≈æen√©</span>
                                <span>Kreativn√≠</span>
                            </div>
                        </div>
                        
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="auto-suggestions" checked class="rounded">
                                <span class="text-sm">Automatick√© n√°vrhy sc√©n</span>
                            </label>
                        </div>
                        
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="real-time-analysis" class="rounded">
                                <span class="text-sm">Real-time anal√Ωza p≈ôi psan√≠</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Collaboration Settings -->
                <div id="collaboration-settings" class="settings-content hidden">
                    <h3 class="text-lg font-semibold mb-4">Nastaven√≠ spolupr√°ce</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="allow-invitations" checked class="rounded">
                                <span class="text-sm">Povolit pozv√°n√≠ ke spolupr√°ci</span>
                            </label>
                        </div>
                        
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="show-presence" checked class="rounded">
                                <span class="text-sm">Zobrazovat mou online p≈ô√≠tomnost</span>
                            </label>
                        </div>
                        
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="email-notifications" checked class="rounded">
                                <span class="text-sm">Email notifikace pro koment√°≈ôe</span>
                            </label>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Defaultn√≠ role pro nov√© spolupracovn√≠ky</label>
                            <select id="default-role" class="w-full p-3 border border-gray-300 rounded-lg">
                                <option value="viewer">Prohl√≠≈æeƒç</option>
                                <option value="commenter">Koment√°tor</option>
                                <option value="editor">Editor</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Export Settings -->
                <div id="export-settings" class="settings-content hidden">
                    <h3 class="text-lg font-semibold mb-4">Export p≈ôedvolby</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Preferovan√Ω form√°t</label>
                            <select id="default-export-format" class="w-full p-3 border border-gray-300 rounded-lg">
                                <option value="pdf">PDF</option>
                                <option value="docx">DOCX</option>
                                <option value="epub">EPUB</option>
                                <option value="txt">Plain text</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">P√≠smo</label>
                            <select id="export-font" class="w-full p-3 border border-gray-300 rounded-lg">
                                <option value="times">Times New Roman</option>
                                <option value="arial">Arial</option>
                                <option value="calibri">Calibri</option>
                                <option value="georgia">Georgia</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Velikost p√≠sma</label>
                            <select id="font-size" class="w-full p-3 border border-gray-300 rounded-lg">
                                <option value="10">10pt</option>
                                <option value="11">11pt</option>
                                <option value="12" selected>12pt</option>
                                <option value="14">14pt</option>
                                <option value="16">16pt</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="include-cover" checked class="rounded">
                                <span class="text-sm">Zahrnout tituln√≠ str√°nku</span>
                            </label>
                        </div>
                        
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="include-toc" class="rounded">
                                <span class="text-sm">Zahrnout obsah</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.export-option:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.settings-tab.active {
    background-color: #3B82F6;
    color: white;
}

.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.max-h-90vh {
    max-height: 90vh;
}

.leading-32 {
    line-height: 8rem;
}

#story-text {
    font-family: 'Georgia', serif;
    line-height: 1.8;
    font-size: 16px;
}

.prose {
    color: #374151;
}

.prose h1, .prose h2, .prose h3 {
    color: #1F2937;
}

.generation-step {
    padding: 8px;
    margin: 4px 0;
    border-radius: 4px;
    background: #F3F4F6;
    border-left: 4px solid #6B7280;
}

.generation-step.active {
    background: #EBF8FF;
    border-left-color: #3B82F6;
    color: #1E40AF;
}

.generation-step.completed {
    background: #F0FDF4;
    border-left-color: #10B981;
    color: #065F46;
}
</style>